# Blockchain Summer2018
## Implementation of encryption algorithm
<br> symmetric cryptography.py Conductiong AES method based on pakage Crypto.Cipher of Anaconda 3-4.1.0 for symmetric encryption
<br> asymmetric cryptography.py The file is carrying out asymmetrically encryption based on the method in RSA package of Anaconda Anaconda 3-4.1.0
### 1. First of all, you need to install Python interpreter version 3.5 +, or use anaconda3 scientific computing tool with Python interpreter embedded directly;
### 2. Installing Crypto:
<br> a. 
```pip install Crypto```
<br> b.
```pip install pycrypto```
<br> c.
```from Crypto.Cipher import AES```
### 3.Installing rsa
<br> 
```pip install rsa```

## Building private chain on geth client
<br> [Solidity Online IDE](http://remix.ethereum.org/)
<br> msg_to_Tony.sol Using Solidity to impliment the intelligent contract of information transmission, taking Tony user as an example.
<br> After the Solidity script is successfully compiled on remix, the compiled JS code is copied to the JavaScript console of Ethereum private chain on the geth client to run the arrangement of smart contracts.

## Experiment Details
### Experiment Environment：
<br> OS: Ubuntu 18.04 LTS
<br> go version go1.10.1 linux/amd64
<br> geth version: 1.8.11-stable
<br> Truffle v4.1.12 (core: 4.1.12)
<br> Solidity v0.4.23 (solc-js)

### 1.Install Go
```sudo add-apt-repository ppa:gophers/go sudo apt-get update sudo apt-get install golang-stable```

### 2.Install Geth
<br>Cloning geth to local env
```$ git clone https://github.com/ethereum/go-ethereum```

<br> 
```
$ sudo add-apt-repository ppa:git-core/ppa
$ sudo apt-get update
$ sudo apt-get install git)
```
<br> Install Go
```$ sudo apt-get install -y build-essential golang```

<br> Construct geth
```
$ cd go-ethereum
$ make geth
```

### 3.BUilding Private Chain
<br> Starting Geth cLIENT（JavaScript Console）
```$ geth --datadir testNet --dev --rpc  console 2>> test.log```

<br>Here –dev represents root model，--rpc represents local rpc portal is 8545，it will be useful for compiling truffle.js.

<br>Configuring initial block - genesis.json
```
{
 "nonce":"0x0000000000000048",
 "mixhash":"0x0000000000000000000000000000000000000000000000000000000000000000",
 "difficulty": "0x200000",
 "alloc": {},
 "coinbase":"0x0000000000000000000000000000000000000000",
 "timestamp": "0x00",
 "parentHash":"0x0000000000000000000000000000000000000000000000000000000000000000",
 "extraData": "",
 "gasLimit":"0xffffffff",
 "config":{
	 "chainID":10,
	 "homesteadBlock":0,
	 "eip155Block":0,
	 "eip158Block":0
 }
}
```

<br>config.chainID: The ID of the blockchain. The -- networkid parameter in the geth command should be consistent with the value of chainid.
<br>config.homesteadBlock: Homestead hard fork block height, no need to pay attention to.
<br>config.eip155Block: EIP 155 hard fork height, no need to pay attention.
<br>config.eip158Block: EIP 158 hard fork height, no need to pay attention.
<br>coinbase: Miner's account. After the first block is excavated, the reward ether will be sent to the miner's account.
<br>difficulty: The greater the difficulty, the more difficult it is.
<br>extraData: Fill in any additional information.
<br>gasLimit: The total consumption limit of gas is used to limit the total amount of transaction information that a block can contain. Here we fill in the maximum value of 0xFFFFFFFF, which is related to whether the smart contract can be mined after being deployed on the chain.
<br>nonce: A 64 bit random number.
<br>mixhash: Used in conjunction with nonce for mining, a hash generated by a part of the previous block.
<br>parentHash: Hash value of the previous block.
<br>alloc: The default account number and the number of ethers in the account number make it easier to mine private chain without configuration.

<br>After the initial state of the private chain network is defined in the JSON file, we can initialize the private chain
```$ geth init /home/supreme_daryl/eth/genesis.json```
            <br>（Here you can modify it according to your own creation block configuration file path.）
<br>The private chain was successfully built.

### 4.Construction of smart contract development framework

<br> Configure and install truffle framework
```$ npm install -g truffle```

<br> Because of the firewall, it may be very slow to install truffle from the source. At this time, you can set up a Taobao source and then download and install it
```
$ npm config set registry https://registry.npm.taobao.org
$ npm install -g truffle
```

```
$ tar xvf node-v9.8.0.tar.gz
$ cd node-v9.8.0
$ ./configure
$ make
$ make install）
```

<br> Solidity is the development language of Ethereum smart contract. To develop and test smart contract, you need to install Solc
```
$ sudo add-apt-repository ppa:ethereum/ethereum
$ sudo apt-get update
$ sudo apt-get install solc
```

### 5.Prepare Geth Client
<br> Start Geth Client
```$ geth --datadir testNet --dev --rpc  console 2>> test.log （将运行日志记录到test.log中）```

<br> View account nodes in the network
```$ eth.accounts```

<br> Creating new acount
```$ personal.newAccount("daryl")```

<br> Unlocking the new account
```
$ personal.unlockAccount(eth.accounts[1], "daryl", 15000)
$ personal.unlockAccount(eth.accounts[0], "", 15000)
```
<br>Start mining

```$ miner.start ()```

<br>There is usually a bug with a return value of null. At present, there is no better and more mature solution on the Internet and in various forums. Everyone is discussing the solution. Moreover, the dev developer version of geth client does not have a clear official website document guide.

<br>At present, the feasible scheme is to set gaslimit in Chuangshi block to the maximum value, that is, 0xFFFFFFFF.

<br>After a while, you will see that the balance of the account address is increased. Assign the account address to the variable acc0, which is convenient for subsequent operations

```$ acc0 = web3. eth.accounts [0]```


### 6.Creating, compiling, deploying the contract

<br> First create a local directory for the smart contract
```
$ sudo mkdir msg_to_Kevin
$ cd msg_to_Kevin
```

<br> Initialize a smart contract project
```$ sudo truffle init```

<br>After successful initialization, you will have the following directory locally
<br>Smart contracts directory
<br>Migrations publishing script directory
<br>Test to store test files
<br>  truffle.js  Truffle's profile

<br>Create an MSG_ To_ Kevin contracts and compiles, creates a msg in the contracts directory_ To_ Tony.sol File, write code as follows
```
pragma solidity ^0.4.24;


contract Msg_to_Tony {
 
  //say msg to Tony
  function key() public pure returns (string) {
      return "3ae07527e5564346cb3ed92547175d0779cebb2f4788726af070086c7e71bae5e32ddba3c759ed6006af0b84b01f1deaae311a7855bcf4e1bc33258d3c0fefa6";
  }
  function A() public pure returns (string) {
    return "164872f0a0f63e828a62c9457f232d6f2895e18dc71c4a80595f3321c65a45770d2bce9cd2d9c04912dfbd4171821b8b96c11eaf1141e6bce993625e838c48b7";
  }
  function D() public pure returns (string) {
    return "3df5b836aa19193ebc0c391a90f837ec00c173def06fea1ec662dc525dae4c15" ;
  }
}
```
<br>Edit 1 in the migrations directory_ initial_ migration.js Deploy the script to add the MSG we just created_ To_ Tony.sol The file is set to the publishing configuration file, and the contents are as follows:
```
var Migrations = artifacts.require("./Migrations.sol");
var msg_to_Kevin = artifacts.require("./msg_to_Kevin.sol");
module.exports = function(deployer) {
deployer.deploy(Migrations);
deployer.deploy(msg_to_Kevin);
};
```
<br>Compiling contract MSG with the tuffle compile command_ To_ Kevin.sol , the compiled file is MSG_ To_ Kevin.json File, stored in the newly generated. / build / contracts directory
```$ truffle compile```
<br>Deploy smart contract, edit truffle.js The configuration file is used to set the location where we will deploy the smart contract later (that is, the established private chain). The contents are as follows:
```
module.exports = {
    networks: {
        development: {
          host: "localhost",
          port: 8545,
          network_id: "*"
        }
    }
};
```
<br> Conducting Deployment
```$ truffle migrate```

### 7.Deploy the contract in geth and call
<br> Open MSG after contract compilation_ To_ Kevin.json File, take out the ABI part and escape JSON, and then assign the content after JSON to MSHK_ ABI variable. Next, find MSG_ To_ Kevin.json The bytecode part of the file, which is assigned to MSHK in geth_ Bytecode variable, and finally evaluates the handling fee required to create the contract. At this time, unlock the account and open the mining to deploy the contract.
```
personal.unlockAccount(eth.accounts[0], "", 15000)
miner.start()
mshk_Contract = web3.eth.contract(mshk_abi);
mshk_hello = mshk_Contract.new({from:acc0, data:mshk_bytecode, gas:300000}, function(e, contract){
if(!e) {
if(!contract.address) {
console.log("Contract transaction send: TransactionHash: " + contract.transactionHash + " waiting to be mined...");
} else {
console.log("Contract mined! Address: " + contract.address);
console.log(contract);
}
}
});
```
<br>The contract is successfully deployed into geth and excavated, confirmed and stored in blocks
<br>At this time, the contract subordinate
```
> msg_to_tony.key()
"3ae07527e5564346cb3ed92547175d0779cebb2f4788726af070086c7e71bae5e32ddba3c759ed6006af0b84b01f1deaae311a7855bcf4e1bc33258d3c0fefa6"
> msg_to_tony.A()
"164872f0a0f63e828a62c9457f232d6f2895e18dc71c4a80595f3321c65a45770d2bce9cd2d9c04912dfbd4171821b8b96c11eaf1141e6bce993625e838c48b7"
> msg_to_tony.D()
"3df5b836aa19193ebc0c391a90f837ec00c173def06fea1ec662dc525dae4c15"
```

<br> Finished!



